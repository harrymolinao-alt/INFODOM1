<!DOCTYPE html>
<html>
  <head>
    <title>Experiencia de Realidad Aumentada Optimizada</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
      body { margin: 0; overflow: hidden; }
      #arjs-video { z-index: -1; }
      .instructions {
        position: absolute;
        top: 20px;
        width: 100%;
        text-align: center;
        color: white;
        font-family: sans-serif;
        font-size: 1.5em;
        text-shadow: 2px 2px 4px #000000;
        z-index: 100;
      }
    </style>
  </head>
  <body>
    <div class="instructions">
      <p>Apunta al marcador para iniciar el video.</p>
    </div>

    <a-scene embedded arjs="sourceType: webcam; detectionMode: mono_and_matrix; patternRatio: 0.7;">
      <a-assets>
        <video id="videoElement" src="video.mp4" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline loop muted></video>
      </a-assets>

      <a-marker type="hiro">
        <a-video
          id="arVideo"
          src="#videoElement"
          width="1"
          height="1.7777"
          position="0 0 0"
          rotation="-90 0 0">
        </a-video>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
    
    <script>
      const videoElement = document.getElementById('videoElement');
      const instructions = document.querySelector('.instructions');

      const marker = document.querySelector('a-marker');
      
      // Controla la reproducción del video cuando el marcador es encontrado
      marker.addEventListener('markerFound', function() {
        // Usa una promesa para manejar la reproducción
        videoElement.play().then(() => {
          console.log("Video started successfully.");
          instructions.style.display = 'none';
        }).catch(error => {
          console.error("Error al iniciar el video:", error);
          // Si el video falla al reproducirse automáticamente, pide interacción del usuario
          instructions.innerHTML = '<p>Toca la pantalla para iniciar el video.</p>';
          instructions.style.display = 'block';
        });
      });
      
      // Pausa el video cuando el marcador se pierde
      marker.addEventListener('markerLost', function() {
        videoElement.pause();
        videoElement.currentTime = 0; // Opcional: regresa el video al inicio
        instructions.innerHTML = '<p>Apunta al marcador para iniciar el video.</p>';
        instructions.style.display = 'block';
      });

      // Lógica de respaldo para la interacción del usuario
      document.body.addEventListener('click', function() {
        if (videoElement.paused) {
          videoElement.play();
        }
      });
    </script>
  </body>
</html>
