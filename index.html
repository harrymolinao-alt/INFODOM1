<!DOCTYPE html>
<html>
  <head>
    <title>AR Video Experience - Mobile Optimized</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #loading-text {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        background-color: rgba(0, 0, 0, 0.7);
        padding: 15px;
        border-radius: 8px;
        font-family: sans-serif;
        font-size: 1.2em;
        z-index: 1000;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="loading-text">Cargando experiencia AR... por favor, escanea el marcador hiro</div>

    <a-scene
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true; antialias: true;"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_multi; patternRatio: 0.85;"
      loading-screen="enabled: false;"
    >
      <a-assets>
        <video
          id="myvideo"
          src="video.mp4"
          autoplay
          loop
          crossorigin="anonymous"
          playsinline
          webkit-playsinline
          preload="auto"
          muted
        ></video>
      </a-assets>

      <a-marker preset="hiro">
        <a-video
          src="#myvideo"
          width="0.32"
          height="0.57" 
          position="0 0 0"
          rotation="-90 0 180"
          scale="-1 1 1"
        ></a-video>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Ocultar el texto de carga una vez que la escena AR esté lista
      document.querySelector('a-scene').addEventListener('loaded', function () {
        const loadingText = document.getElementById('loading-text');
        if (loadingText) {
          loadingText.style.display = 'none';
        }
        // Asegurarse de que el video se reproduzca en iOS
        const videoElement = document.getElementById('myvideo');
        if (videoElement) {
          videoElement.play().catch(error => {
            console.log("Autoplay prevented:", error);
            // Mostrar un botón de "tocar para reproducir" si el autoplay falla
            const playButton = document.createElement('button');
            playButton.textContent = 'Tocar para iniciar AR';
            playButton.style.position = 'fixed';
            playButton.style.top = '50%';
            playButton.style.left = '50%';
            playButton.style.transform = 'translate(-50%, -50%)';
            playButton.style.zIndex = '1001';
            playButton.style.padding = '15px 30px';
            playButton.style.fontSize = '1.5em';
            playButton.style.backgroundColor = '#007bff';
            playButton.style.color = 'white';
            playButton.style.border = 'none';
            playButton.style.borderRadius = '10px';
            playButton.onclick = () => {
              videoElement.play();
              playButton.remove();
            };
            document.body.appendChild(playButton);
          });
        }
      });
    </script>
  </body>
</html>
